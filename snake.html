<!DOCTYPE html>
<html>

<head>
  <title>Snake</title>
</head>

<body>
  <canvas id="canvas" width="1024" height="1024"></canvas>
  <script>
    var game = {
      tickNumber: 0,
      timer: null,
      board: [
        "###############",
        "#             #",
        "#             #",
        "#             #",
        "#     ####    #",
        "#     ####    #",
        "#             #",
        "#             #",
        "#             #",
        "###############"
      ],
      fruit: [
        {x: 1, y: 1}
      ],
      tick: function () {
        window.clearTimeout(game.timer);
        game.tickNumber++;
       var result = snake.move();
        if(result == "gameover") {
          alert("Game Over!");
          return;
        }
        graphics.drawGame();
        game.timer = window.setTimeout(game.tick, 500);
      },
      isEmpty: function (location) {
        return game.board[location.y][location.x] == ' ';
      },
      isWall: function (location) {
        return game.board[location.y][location.x] == '#';
      },
      isFruit: function (location) {
        for(var fruitNumber = 0; fruitNumber < game.fruit.length; fruitNumber++) {
          var fruit = game.fruit[fruitNumber];
          if(location.x == fruit.x && location.y == fruit.y) {
            game.fruit.splice(fruitNumber, 1);
            return true;
          }
        }
        return false;
      }
    }
    var graphics = {
      canvas: document.getElementById("canvas"),
      squareSize: 30, 
      draw: function(ctx, source, color) {
        source.forEach(function(part) {
          var partXlocation = part.x * graphics.squareSize;
          var partYlocation = part.y * graphics.squareSize;
          ctx.fillStyle = color;
          ctx.fillRect(partXlocation, partYlocation, graphics.squareSize, graphics.squareSize);
        });
      },
      drawGame: function () {
        var ctx = graphics.canvas.getContext("2d");
        ctx.clearRect(0, 0, graphics.canvas.width, graphics.canvas.height);
      graphics.draw(ctx, snake.parts, "green");
        graphics.draw(ctx. game.fruit, "red");
      },
      drawBoard: function () {
        var ctx = graphics.canvas.getContext("2d");
        var currentYoffset = 0;

        game.board.forEach(function (line) {
          line = line.split('');
          var currentXoffset = 0;

          line.forEach(function (character) {
            if (character == '#') {
              ctx.fillStyle = "black";
              ctx.fillRect(currentXoffset, currentYoffset, graphics.squareSize, graphics.squareSize);
            }
            currentXoffset += graphics.squareSize;
          });

          currentYoffset += graphics.squareSize;
        });
      }
    };

    var snake = {
      parts: [
        {x: 4, y: 2},
        {x: 3, y: 2},
        {x: 2, y: 2},
      ],
      facing: "E",
      nextLocation: function () {
        var head = this.parts[0];
        var next = {x: head.x, y: head.y};
        if (this.facing === "E") next.x++;
        if (this.facing === "W") next.x--;
        if (this.facing === "N") next.y--;
        if (this.facing === "S") next.y++;
        return next;
      },
      move: function () {
        var location = this.nextLocation();
        if (game.isEmpty(location)) {
          this.parts.unshift(location);
          this.parts.pop();
        }
        if(game.isWall(location)) {
          return "gameover";
        }
        if(game.isFruit(location)) {
          snake.parts.unshift(location);
          game.score++;
        alert('Fruit');
        }
      },
      drawFruit: function(ctx) {
        game.fruit.forEach(function(part) {
          var partXlocation = part.x * graphics.squareSize;
          var partYlocation = part.y * graphics.squareSize;
          ctx.fillStyle = "red";
          ctx.fillRect(partXlocation, partYlocation, graphics.squareSize, graphics.squareSize);
            });
      },
      drawSnake: function () {
        var ctx = graphics.canvas.getContext("2d");
        this.parts.forEach(function (part) {
          var partXlocation = part.x * graphics.squareSize;
          var partYlocation = part.y * graphics.squareSize;
          ctx.fillStyle = "green";
          ctx.fillRect(partXlocation, partYlocation, graphics.squareSize, graphics.squareSize);
        });
      }
    };
    var gameControl = {
      processInput: function (keyPressed) {
        var key = keyPressed.key.toLowerCase();
        var targetDirection = snake.facing;
        if (key == "w") targetDirection = "N";
        if (key == "a") targetDirection = "W";
        if (key == "s") targetDirection = "S";
        if (key == "d") targetDirection = "E";
        snake.facing = targetDirection;
        game.tick();
      },
      startGame: function () {
        window.addEventListener("keypress", gameControl.processInput, false);
        game.tick();
      }
    };

    gameControl.startGame();
  </script>
</body>

</html>
